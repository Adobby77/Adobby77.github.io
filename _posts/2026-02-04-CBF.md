---
layout: post
title: Control Barrier Functions
date: 2026-02-04 12:00:00 +0900
description: Introduction to Control Barrier Functions and Safety Control
tags: CBF Lyapunov
categories: study
---

Control Barrier Function is one of the most popular methods of 'Safety Control'.

This documents mainly refers to 'Control Barrier Functions: Theory and Applications (2019)' and includes additional explanations from other references.


## 1. Introduction

### 1.1. Motivation

- **Intuition of Liveness & Safety**
	- **Liveness:** "Good" things eventually happen. (ex: Asymptotic Stability)
	- **Safety:** "Bad" things do not happen. (ex: Invariance)


- **Motivation (Why CBF?)**
	1. **Societal need for safety control** 
	
		Much of the recent interest lies broadly on autonomous systems, that are expected to operate in ==unknown and unstructured environments.== 
		However, while the modern control theory dominantly focuses on methods analyzing and implementing liveness such as Lyapunov functions, the research about ==ensuring safety was not extensively studied.==


	2. **Usefulness** 
 
		Lots of ==methods based on Lyapunov theory can be suitably transposed== to address the safety considerations,

<div style="height: 0.1em;"></div> 

### 1.2. A Brief History of Barrier Functions

As we mentioned above, our major concern in safety control is **invariance**- ensuring that the system states remain within a predefined safe set.

First, introduce a definition of safe set.

##### Def 1.1) Safe set

> Given a smooth function $h:\R^n\to\R$, a safe set $\mathcal{C}$ is a superlevel set $$\mathcal{C}=\{x\in\R^n:h(x)\geq 0\}$$
> satisfying $\del h(x)=\frac{\pp h}{\pp x}(x)\neq0$ for all $x\in\pp \mathcal{C}=\{x\in\R^n:h(x)=0\}$.

Here, he boundary condition is required to guarantee that the boundary $\pp\mathcal{C}$ be smooth $(n-1)$-dimensional manifold.

#### 1.2.1. Bony-Brezis theorem

One of the most monumental theorem is a **Bony-Brezis theorem (also called Nagumo's theorem)**, that gives necessary and sufficient conditions for set invariance.

##### Thm 1.2) Bony-Brezis theorem
> 
> Let $F$ be closed subset of a $C^2$ manifold $M$ and let $X$ be a vector field on $M$ which is Lipschitz continuous. Then, TFAE:
> 1. Every integral curve of $X$ starting in $F$ remains in $F$.
> 2. $(X(m),v)\leq 0$ for every exterior normal vector $v$ at a point $m\in F$.

<div style="height: 0.1em;"></div>

In the context of control theory, we can translate such a theorem in more familiar form below.

> Given a dynamical system $\dot x=f(x)$ with $x\in \R^n$, let the safe set $\mathcal{C}$ corresponding to a smooth function $h:\R^n\to\R$.
> 
> Then, TFAE:
> 1. $\mathcal{C}$ is invariant.
> 2. $\dot h(x)\geq 0,\q\forall x\in\partial C=\{x:h(x)=0\}$.

Here, $\dot h(x)=\frac{dh}{dt}=\frac{\pp h}{\pp x}\frac{dx}{dt}=\frac{\pp h}{\pp x} f(x)$.

<div style="height: 0.1em;"></div>

> [!note] Comparison of the Two forms
> 
> | Component | Geometric Form | Functional Form |
> | :--- | :---: | :---: |
> | **Motion** | Vector field $X(m)$ | System dynamics $f(x)$ |
> | **Safe Region** | Closed set $F$ | Superlevel set $\{x : h(x) \ge 0\}$ |
> | **Boundary Vector** | Exterior normal $\nu$ (points **out**) | Gradient $\nabla h$ (points **in**) |
> | **The Requirement** | Velocity must not point **out** ($\le 0$) | $h$ must not **decrease** ($\ge 0$) |
> 
<div style="height: 0.1em;"></div>


#### 1.2.2. Barrier Certificates

Barrier Certificates was introduced to formally prove safety of nonlinear and hybrid systems.

##### Def 1.3) Barrier Certificates
> 
> Let $\mathcal{C_0}$ be the set of initial conditions and $\mathcal{C}_u$ be an unsafe set.  Then, a function $B:\R^n\to R$ is called a **barrier certificate** if
> 1. $B(x)\leq 0$ for all $x\in \mathcal{C}_0$
> 2. $B(x)> 0$ for all $x\in \mathcal{C}_u$
> 3. $\dot B(x)\leq 0\;\Longrightarrow\;\mathcal{C}$ is invariant (where $\mathcal{C}=\mathcal{C}_u^c$).

Here, by letting $h=-B$, the $h$ in the Bony-Brezis theorem corresponds to the restriction of the barrier certificate to $\partial C$.

<div style="height: 0.1em;"></div>

#### 1.2.3. Barrier Lyapunov Functions

To extend the safety guarantees beyond the boundary of the set, a various "Lyapunov-like" approaches were introduced.

##### Def 1.4) Barrier Lyapunov functions

>Let $\mathcal{C_0}$ be the set of initial conditions and $\mathcal{C}_u$ be an unsafe set.  Then, a function $B:\R^n\to R$ is called a **barrier Lyapunov function** if
> 1. $B(x)\leq 0$ for all $x\in \mathcal{C}_0$
> 2. $B(x)> 0$ for all $x\in \mathcal{C}_u$
> 3. $\dot B(x)\leq 0\;\Longrightarrow\;\mathcal{C}$ is invariant (where $\mathcal{C}=\mathcal{C}_u^c$).
> 4. $B$ is positive definite.

This is just adding "positive definiteness" to the definition of Barrier certificate $B$.

Then, $\dot B(x)\leq 0$ be satisfied for all $x\in \mathcal{C}$.

- **Advantage:** It ensures **invariance and hence safety**.
- **Limitation:** They enforce every level set invariant and hence they be **overly conservative.**

> [! note] Limitation of BLF
> 
> Let $\Omega_c=\{x(t):B(x(t))\leq c\}\subset \mathcal{C}$ is a sublevel set of $B$. 
> 
> Then, by the definition of sublevel set, 
> 1. $\Omega_{c_1}\subseteq\Omega_{c_2}$ iff $c_1\leq c_2$.
> 2. $\exists c_{\text{max}}$ s.t. $\Omega_c\subset\Omega_{c_\max}=\mathcal{C}$ for all $c\leq c_\max$ and $\Omega_c\not\subset\mathcal{C}$ for all $c>c_\max$.
> 
> Here, let $B(x(0))=c_0$ and hence $x(0)\in\Omega_{c_0}$.
> 
> If $B$ is a barrier Lyapunov function, then $\dot B(x(t))\leq 0$ for all $t$ and hence $x(t)\in \Omega_{c_0}$ for all $t$, i.e. $B(x(t))\leq c_0$ for all $t$. So, while this system is obviously safe, but overly conservative.
> 
> - **The Trap**: If the system starts in a "very safe" state where $c_0​\ll c_\max$​, it is mathematically forbidden from moving toward the boundary of $\mathcal{C}$.
> - **The Lost Space**: The region $C\setminus \Omega_{c_0}$​​ becomes "dead space." Even though these states are safe, the BLF controller will treat them as "forbidden" because reaching them would require $B(x)$ to increase ($\dot B>0$), which is prohibited.

<div style="height: 0.1em;"></div>

#### 1.2.4. Open Dynamical Systems

Early work, such as Bony-Brezis theorem or Barrier Certificates, focused on **closed systems** $(\dot x=f(x))$, which was more about **analysis and verification(not control)** of existing dynamics.

The discussion then shifted to **open systems** $(\dot x=f(x)+g(x)u)$, moving from passive observation to **active control synthesis**.

In this paradigm, the barrier certificate was extended to the first definition of a control barrier function.

First, introduce the definition.

##### Def 1.5) Forward invariant set, Safe system

> The set $\mathcal{C}$ is called **forward invariant** if for every $x_0\in\mathcal{C}$, $x(t)\in\mathcal{C}$ for $x(0)=x_0$ and all $t\in \left[0,\tau_\max\right)$. The system is called **safe** w.r.t. $\mathcal{C}$ if the safe set $\mathcal{C}=\{x\in D:h(x)\geq 0\}$ of the system is forward invariant.

##### Def 1.6) First version of Control Barrier Function
> Consider a control system $\dot x(t)=f(x)+g(x)u$ and a safe set $\mathcal{C}\subset D\subset\R^n$ defined as the superlevel set of a continuously differentiable function $h:D\to \R$, i.e. $$\mathcal{C}=\{x\in D:h(x)\geq 0\}$$
> 
> Then, the function $h$ is a **control barrier function** if for all $x\in\mathcal{C}$, there exists a control input $u\in U$ such that $$\dot h(x,u)\geq 0\;\Longrightarrow\;\mathcal{C}\;\text{ is forward invariant}$$
> 



---

### 2. Foundations of Control Barrier Functions


#### 2.1. Motivation: Control Lyapunov Functions

#### 2.2. Control Barrier Functions